# Text Messaging App - プロジェクト設定

## インフラ構成

### 基本構成

| 項目 | 選択 |
|------|------|
| **コンピュート** | ECS Fargate |
| **コンテナレジストリ** | ECR |
| **データベース** | PostgreSQL (RDS) |
| **ロードバランサー** | ALB |
| **IaC** | AWS CDK |
| **環境** | dev のみ |

### スケーリング・デプロイ

| 項目 | 選択 |
|------|------|
| **Auto Scaling** | ECS Service Auto Scaling (CPU/メモリベース) |
| **デプロイ戦略** | Blue/Green (CodeDeploy) |

### アーキテクチャ図

```
┌──────────────────────────────────────────────────────────────┐
│                           VPC                                │
│                                                              │
│  ┌─────────────────────┐      ┌─────────────────────┐       │
│  │   Public Subnet A   │      │   Public Subnet C   │       │
│  │        (ALB)        │      │        (ALB)        │       │
│  └──────────┬──────────┘      └──────────┬──────────┘       │
│             │                            │                   │
│             └────────────┬───────────────┘                   │
│                          ▼                                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                  ALB (Application LB)                  │  │
│  │            ┌─────────────────────────┐                 │  │
│  │            │  Blue/Green Target Groups │                │  │
│  │            │   - Blue (本番)           │                │  │
│  │            │   - Green (新バージョン)    │                │  │
│  │            └─────────────────────────┘                 │  │
│  └───────────────────────────┬───────────────────────────┘  │
│                              ▼                               │
│  ┌─────────────────────┐      ┌─────────────────────┐       │
│  │  Private Subnet A   │      │  Private Subnet C   │       │
│  │   (ECS Fargate)     │      │   (ECS Fargate)     │       │
│  │                     │      │                     │       │
│  │  ┌───────────────┐  │      │  ┌───────────────┐  │       │
│  │  │ Auto Scaling  │  │      │  │ Auto Scaling  │  │       │
│  │  │  Min: 1       │  │      │  │  Min: 1       │  │       │
│  │  │  Max: N       │  │      │  │  Max: N       │  │       │
│  │  └───────────────┘  │      │  └───────────────┘  │       │
│  └──────────┬──────────┘      └──────────┬──────────┘       │
│             │                            │                   │
│             └────────────┬───────────────┘                   │
│                          ▼                                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                 RDS PostgreSQL                         │  │
│  │               (Private Subnet)                         │  │
│  │                 Multi-AZ: No (dev環境)                  │  │
│  └───────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────┘

外部サービス:
┌─────────┐     ┌─────────────┐
│   ECR   │     │  CodeDeploy │
│ (イメージ) │     │ (B/Gデプロイ) │
└─────────┘     └─────────────┘
```

### AWSサービス一覧

| カテゴリ | サービス | 用途 |
|---------|---------|------|
| ネットワーク | VPC | 仮想ネットワーク |
| | ALB | ロードバランシング |
| コンピュート | ECS | コンテナオーケストレーション |
| | Fargate | サーバーレスコンテナ実行 |
| ストレージ | ECR | コンテナイメージ保存 |
| データベース | RDS PostgreSQL | リレーショナルDB |
| デプロイ | CodeDeploy | Blue/Greenデプロイ |
| スケーリング | Application Auto Scaling | ECSタスク自動スケール |

### Auto Scaling 設定方針

- **スケーリングメトリクス**: CPU使用率 / メモリ使用率
- **ターゲット値**: 70%
- **最小タスク数**: 1
- **最大タスク数**: 学習用なので控えめに設定（コスト考慮）
- **クールダウン**: スケールイン/アウト 300秒

### Blue/Green デプロイ設定方針

- **デプロイタイプ**: CodeDeployDefault.ECSAllAtOnce（学習用）
- **トラフィック切り替え**: 即時（本番では段階的も選択可能）
- **ロールバック**: 自動（ヘルスチェック失敗時）
- **ターゲットグループ**: Blue/Green 2つ用意

## 技術スタック

- **言語**: Go 1.22+
- **Webフレームワーク**: net/http (標準ライブラリ)
- **WebSocket**: gorilla/websocket (フェーズ3で導入)
- **データベース**: PostgreSQL (RDS)
- **IaC**: AWS CDK (TypeScript)

## 実装フェーズ

1. ✅ フェーズ1: 基礎設定
2. ✅ フェーズ2: シンプルなメッセージングAPI
3. ✅ フェーズ3: WebSocketによるリアルタイム通信
4. ✅ フェーズ4: データベース統合 (RDS PostgreSQL)
5. ✅ フェーズ5: AWSデプロイ (ECS/Fargate + CDK)
